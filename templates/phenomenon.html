<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>現象データ入力</title>
    <script>
        // 小分類のドロップダウンを更新する関数
        function updateSubcategories() {
            const category = document.getElementById("category").value;  // 大分類の現在の選択を取得
            const subcategorySelect = document.getElementById("subcategory");  // 小分類のドロップダウン
            const subcategories = {{ categories | tojson | safe }};  // Pythonから渡されたカテゴリーのデータ
            
            // サブカテゴリの選択肢を初期化
            subcategorySelect.innerHTML = "<option value=''>--選択してください--</option>";

            // 大分類に対応するデータがあればサブカテゴリを追加
            if (subcategories[category]) {
                subcategories[category].forEach(function(subcategory) {
                    const option = document.createElement("option");
                    option.value = subcategory;
                    option.textContent = subcategory;
                    subcategorySelect.appendChild(option);
                });
            }
        }
    </script>
</head>
<body>
    <h1>現象データ入力</h1>

    <!-- 現象データの追加フォーム -->
    <form action="/phenomenon" method="post">
        <label for="category">大分類:</label>
        <select id="category" name="category" onchange="updateSubcategories()" required>
            <option value="">--選択してください--</option>
            {% for category in categories.keys() %}
            <option value="{{ category }}">{{ category }}</option>
            {% endfor %}
        </select><br><br>

        <label for="subcategory">小分類:</label>
        <select id="subcategory" name="subcategory" required>
            <option value="">--選択してください--</option>  <!-- 初期状態 -->
        </select><br><br>

        <label for="change_area">変更箇所:</label>
        <select id="change_area" name="change_area" required>
            {% for area in change_areas %}
            <option value="{{ area }}">{{ area }}</option>
            {% endfor %}
        </select><br><br>

        <button type="submit">追加</button>
    </form>

    <!-- 追加された現象データ一覧 -->
    <h2>現在の入力された現象データ</h2>
    <ul>
        {% for category, subcategory, change_area in phenomena %}
        <li>{{ category }} - {{ subcategory }} - {{ change_area }}</li>
        {% endfor %}
    </ul>

    <!-- 保存フォーム -->
    <form action="/save_phenomena" method="post">
        <button type="submit">保存</button>
    </form>
</body>
</html>